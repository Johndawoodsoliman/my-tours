(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{1041:function(o,t,e){"use strict";e(781)},1042:function(o,t,e){"use strict";e(782)},1236:function(o,t,e){"use strict";e.r(t);var n=e(14),r=e(5);e(30),e(180),e(23),e(31);function d(o,t){var e=Object.keys(o);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(o);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),e.push.apply(e,n)}return e}function c(o){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?d(Object(e),!0).forEach((function(t){Object(n.a)(o,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(e)):d(Object(e)).forEach((function(t){Object.defineProperty(o,t,Object.getOwnPropertyDescriptor(e,t))}))}return o}var l={name:"MyProductTourBooking",props:{productId:{type:String,required:!0},departDate:{type:String,required:!0},travelDays:{type:Number,required:!0},dayPriceInfo:{type:Object,required:!0},groupDiscount:{type:Number,default:0},minGuestNumber:{type:Number,required:!0},maxGuestNumber:{type:Number,required:!0},minChildAge:{type:[Number,void 0],default:0},maxChildAge:{type:[Number,void 0],default:0}},data:()=>({bookingInfoLoading:!0,productUpgradesInfo:[],productPayUpgradeInfo:[],bookingInfoForm:{productId:"",departureDate:"",roomInfo:[{adult:1,child:0,singlePairup:0}],departureLocation:"",endLocation:"",upgradeInfo:[]},bookingInfoRules:{roomInfo:{required:!0,trigger:"change"},departureLocation:{required:!0,message:"Please select or enter",trigger:["blur","change"]},endLocation:{required:!0,message:"Please select or enter",trigger:["blur","change"]},upgradeInfo:[]},departureLocationStatus:0,departureLocationOptions:[],endLocationStatus:0,endLocationOptions:[]}),computed:{displayLocationInfo(){var o=(1===this.departureLocationStatus||2===this.departureLocationStatus)&&this.departureLocationOptions.length>0||3===this.departureLocationStatus,t=(1===this.endLocationStatus||2===this.endLocationStatus)&&this.endLocationOptions.length>0||3===this.endLocationStatus;return o||t},groupDepartureLocation(){var o=[];return this.departureLocationOptions.forEach((t=>{for(var e=-1,i=0;i<o.length;i++)t.region===o[i].region&&(e=i);e>-1?o[e].children.push(t):o.push({region:t.region,children:[t]})})),o},groupDepartureEndLocation(){var o=[];return this.endLocationOptions.forEach((t=>{for(var e=-1,i=0;i<o.length;i++)t.region===o[i].region&&(e=i);e>-1?o[e].children.push(t):o.push({region:t.region,children:[t]})})),o}},watch:{productId:{immediate:!0,handler(o){this.bookingInfoForm.productId=o}},departDate:{immediate:!0,handler(o){var t=this;return Object(r.a)((function*(){if(o&&t.bookingInfoForm.productId){t.bookingInfoForm.departureDate=o;for(var i=1;i<5;i++){var e="";if(1===i&&(e="single"),2===i&&(e="double"),3===i&&(e="triple"),4===i&&(e="quad"),!t.disabledAdultOption({child:0},i,e)){t.bookingInfoForm.roomInfo=[{adult:i,child:0,singlePairup:0}];break}}t.$nextTick((()=>t.bookingScrollIntoView())),t.bookingInfoLoading=!0,yield t.getTourUpgrades(),yield t.getTourLocationInfo(),t.bookingInfoLoading=!1}}))()}},minGuestNumber:{immediate:!0,handler(o){this.bookingInfoForm.roomInfo[0].adult=o||1}},bookingInfoForm:{deep:!0,handler(o){this.productPayUpgradeInfo=[],o.upgradeInfo.forEach(((o,t)=>{this.productUpgradesInfo[t].options.forEach((e=>{Array.isArray(o)?o.forEach((o=>{o===e.id&&e.price&&this.productPayUpgradeInfo.push(c(c({},e),{},{upgradeId:this.productUpgradesInfo[t].id}))})):o===e.id&&e.price&&this.productPayUpgradeInfo.push(c(c({},e),{},{upgradeId:this.productUpgradesInfo[t].id}))}))})),this.$emit("getPriceInfo",this.$productTourPriceInfo(this.dayPriceInfo,o.roomInfo,this.productPayUpgradeInfo,this.groupDiscount))}}},methods:{addBookingRoom(){this.bookingInfoForm.roomInfo.push({adult:this.minGuestNumber||1,child:0,singlePairup:0}),this.bookingRoomChange()},removeBookingRoom(){this.bookingInfoForm.roomInfo.splice(-1,1),this.bookingRoomChange()},bookingRoomChange(){this.bookingInfoForm.roomInfo.forEach((o=>{(1!==o.adult||0!==o.child)&&(o.singlePairup=0)})),this.bookingInfoForm.upgradeInfo=[],this.productUpgradesInfo.forEach((o=>{this.bookingInfoForm.upgradeInfo.push(0===o.canMultiSelect?"":[])})),this.$nextTick((()=>this.$refs.bookingInfoFormRef.clearValidate()))},disabledAdultOption(o,t,e){var n=this.maxGuestNumber-o.child-t<0,r=0===this.dayPriceInfo[e];return n||r},disabledChildOption(o,t){return this.maxGuestNumber-o.adult-t<0},displayLocation(o){var t=o.startTime?this.$dateMoment("1900-01-01 ".concat(o.startTime)).format("hh:mm A"):"",e=o.endTime?this.$dateMoment("1900-01-01 ".concat(o.endTime)).format("hh:mm A"):"",n="".concat(o.region," | ").concat(o.location," | ").concat(o.address),r="".concat(t).concat(e?"-".concat(e):""),d=o.tips;return"".concat(r?"".concat(r," | "):"").concat(n).concat(d?" ( Note: ".concat(d," ) "):"")},getTourLocationInfo(){var o=this;return Object(r.a)((function*(){var data=yield o.$axios.get("/api/product/tour_departure_location",{params:{productId:o.bookingInfoForm.productId,departureDate:o.bookingInfoForm.departureDate}});0===data.data.code&&(o.departureLocationStatus=data.data.data.startLocations.locationStatus,o.departureLocationOptions=data.data.data.startLocations.locations,o.endLocationStatus=data.data.data.endLocations.locationStatus,o.endLocationOptions=data.data.data.endLocations.locations,o.$set(o.bookingInfoForm,"departureLocation",2===o.departureLocationStatus&&o.departureLocationOptions.length>0?o.displayLocation(o.departureLocationOptions[0]):""),o.$set(o.bookingInfoForm,"endLocation",2===o.endLocationStatus&&o.endLocationOptions.length>0?o.displayLocation(o.endLocationOptions[0]):""),o.$nextTick((()=>o.$refs.bookingInfoFormRef.clearValidate())))}))()},getTourUpgrades(){var o=this;return Object(r.a)((function*(){o.$emit("changeUpgrade",!0);var data=yield o.$axios.get("/api/product/upgrades",{params:{productId:o.bookingInfoForm.productId,departureDate:o.bookingInfoForm.departureDate,currency:o.$store.state.currency}});o.$emit("changeUpgrade",!1),0===data.data.code&&(o.productUpgradesInfo=data.data.data,o.$set(o.bookingInfoForm,"upgradeInfo",[]),o.$set(o.bookingInfoRules,"upgradeInfo",[]),o.productUpgradesInfo.forEach((t=>{var e={required:!0,message:"Please select ".concat(0===t.requiredNo?"at least 1":t.requiredNo," options."),trigger:"change"};0!==t.canMultiSelect&&(e.type="array"),0!==t.canMultiSelect&&0!==t.requiredNo&&(e.len=t.requiredNo),o.bookingInfoRules.upgradeInfo.push(e),o.bookingInfoForm.upgradeInfo.push(0===t.canMultiSelect?"":[])})),o.$nextTick((()=>o.$refs.bookingInfoFormRef.clearValidate())))}))()},disabledUpgradeOption(option){var o=0;return this.bookingInfoForm.roomInfo.forEach((t=>{o+=t.adult,o+=t.child})),option.numberPeople.includes("-")?o<option.minPeople||o>option.maxPeople:0!==parseInt(option.numberPeople)&&o!==parseInt(option.numberPeople)},bookingScrollIntoView(){this.$refs.MyProductTourBookingRef.scrollIntoView({behavior:"smooth"})},locationScrollIntoView(){this.$refs.MyProductTourBookingLocationRef&&this.$refs.MyProductTourBookingLocationRef.scrollIntoView({behavior:"smooth"})},UpgradesScrollIntoView(){this.$refs.MyProductTourBookingUpgradesRef&&this.$refs.MyProductTourBookingUpgradesRef.scrollIntoView({behavior:"smooth"})},bookingSubmit(){return new Promise((o=>{var t=0;this.bookingInfoForm.roomInfo.forEach((o=>{t+=o.adult,t+=o.child})),t>=this.minGuestNumber?this.$refs.bookingInfoFormRef.validate(((t,e)=>{t?(this.bookingInfoForm.attributeInfo=[],this.bookingInfoForm.upgradeInfo.forEach(((o,t)=>{this.productUpgradesInfo[t].options.forEach((e=>{Array.isArray(o)?o.forEach((o=>{o===e.id&&this.bookingInfoForm.attributeInfo.push({name:this.productUpgradesInfo[t].name,optionId:e.id,optionName:e.name,upgradeId:this.productUpgradesInfo[t].id,providerTourCode:e.providerTourCode})})):o===e.id&&this.bookingInfoForm.attributeInfo.push({name:this.productUpgradesInfo[t].name,optionId:e.id,optionName:e.name,upgradeId:this.productUpgradesInfo[t].id,providerTourCode:e.providerTourCode})}))})),o({status:"success",data:c(c({},this.bookingInfoForm),{},{endDate:this.$dateMoment(this.departDate).add(this.travelDays-1,"days").format("YYYY-MM-DD"),productPayUpgradeInfo:this.productPayUpgradeInfo,dayPriceInfo:this.dayPriceInfo,grossProfitDiscount:this.groupDiscount})})):(o({status:"failed"}),e.departureLocation||e.endLocation?this.locationScrollIntoView():this.UpgradesScrollIntoView())})):(this.$message({type:"error",offset:300,message:"Minimum ".concat(this.minGuestNumber," people to order")}),o({status:"failed"}),this.bookingScrollIntoView())}))}}},m=(e(1041),e(1042),e(63)),component=Object(m.a)(l,(function(){var o=this,t=o._self._c;return o.departDate?t("div",{ref:"MyProductTourBookingRef",attrs:{id:"my-product-tour-booking"}},[t("div",{staticClass:"my-product-tour-booking-content"},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:o.bookingInfoLoading,expression:"bookingInfoLoading"}],ref:"bookingInfoFormRef",attrs:{"label-position":"top",model:o.bookingInfoForm,rules:o.bookingInfoRules}},[t("div",{staticClass:"my-product-tour-booking-content-item"},[t("div",{staticClass:"my-product-tour-booking-content-item-title"},[o._v("Departure Date")]),o._v(" "),t("div",{staticClass:"my-product-tour-booking-content-item-content"},[t("el-form-item",[t("div",{staticClass:"my-product-tour-booking-content-date",on:{click:function(t){return o.$emit("changeDepartDate")}}},[t("i",{staticClass:"el-icon-date"}),o._v(" "),t("span",[o._v(o._s(o.$dateMoment(o.departDate).format("MMMM DD, YYYY")))])])])],1)]),o._v(" "),o._l(o.bookingInfoForm.roomInfo,(function(e,n){return t("div",{key:n,staticClass:"my-product-tour-booking-content-item"},[t("div",{staticClass:"my-product-tour-booking-content-item-title"},[o._v(o._s("Room ".concat(n+1)))]),o._v(" "),t("div",{staticClass:"my-product-tour-booking-content-item-content inline"},[t("el-form-item",{attrs:{label:"Adult"}},[t("el-select",{attrs:{placeholder:"Please select"},on:{change:o.bookingRoomChange},model:{value:e.adult,callback:function(t){o.$set(e,"adult",t)},expression:"item.adult"}},[t("el-option",{attrs:{label:"1",value:1,disabled:o.disabledAdultOption(e,1,"single")}}),o._v(" "),t("el-option",{attrs:{label:"2",value:2,disabled:o.disabledAdultOption(e,2,"double")}}),o._v(" "),t("el-option",{attrs:{label:"3",value:3,disabled:o.disabledAdultOption(e,3,"triple")}}),o._v(" "),t("el-option",{attrs:{label:"4",value:4,disabled:o.disabledAdultOption(e,4,"quad")}})],1)],1),o._v(" "),o.dayPriceInfo.kid?t("el-form-item",[t("div",{staticClass:"child-label",attrs:{slot:"label"},slot:"label"},[t("span",[o._v("Child")]),o._v(" "),t("el-popover",{attrs:{placement:"top",trigger:"hover",content:o.$getTravelerAgeLabel(o.minChildAge,o.maxChildAge)},scopedSlots:o._u([{key:"reference",fn:function(){return[t("i",{staticClass:"el-icon-warning-outline"})]},proxy:!0}],null,!0)})],1),o._v(" "),t("el-select",{attrs:{placeholder:"Please select"},on:{change:o.bookingRoomChange},model:{value:e.child,callback:function(t){o.$set(e,"child",t)},expression:"item.child"}},[t("el-option",{attrs:{label:"0",value:0,disabled:o.disabledChildOption(e,0)}}),o._v(" "),t("el-option",{attrs:{label:"1",value:1,disabled:o.disabledChildOption(e,1)}}),o._v(" "),t("el-option",{attrs:{label:"2",value:2,disabled:o.disabledChildOption(e,2)}}),o._v(" "),t("el-option",{attrs:{label:"3",value:3,disabled:o.disabledChildOption(e,3)}}),o._v(" "),t("el-option",{attrs:{label:"4",value:4,disabled:o.disabledChildOption(e,4)}})],1)],1):o._e(),o._v(" "),o.dayPriceInfo.singlePairup?t("el-form-item",[t("div",{staticClass:"sing-pair-up"},[1===e.adult&&0===e.child?[t("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.singlePairup,callback:function(t){o.$set(e,"singlePairup",t)},expression:"item.singlePairup"}},[o._v("\n                                    Shared room\n                                ")]),o._v(" "),t("el-popover",{attrs:{width:"200",placement:"top",trigger:"hover",content:"Share with a same-gender traveler, separate beds."},scopedSlots:o._u([{key:"reference",fn:function(){return[t("i",{staticClass:"el-icon-warning-outline"})]},proxy:!0}],null,!0)})]:o._e()],2)]):o._e()],1)])})),o._v(" "),t("div",{staticClass:"my-product-tour-booking-content-action"},[t("el-button",{attrs:{icon:"el-icon-plus"},on:{click:o.addBookingRoom}},[o._v("\n                    Room\n                ")]),o._v(" "),o.bookingInfoForm.roomInfo.length>1?t("el-button",{staticClass:"minus",attrs:{icon:"el-icon-minus"},on:{click:o.removeBookingRoom}},[o._v("\n                    Room\n                ")]):o._e()],1),o._v(" "),o.displayLocationInfo?t("div",{ref:"MyProductTourBookingLocationRef",staticClass:"my-product-tour-booking-content-item"},[t("div",{staticClass:"my-product-tour-booking-content-item-title"},[o._v("Departure Info")]),o._v(" "),t("div",{staticClass:"my-product-tour-booking-content-item-content"},[1===o.departureLocationStatus&&o.departureLocationOptions.length>0?t("el-form-item",{attrs:{label:"Meeting Point",prop:"departureLocation"}},[t("el-select",{attrs:{"popper-append-to-body":!1,placeholder:"Please select"},model:{value:o.bookingInfoForm.departureLocation,callback:function(t){o.$set(o.bookingInfoForm,"departureLocation",t)},expression:"bookingInfoForm.departureLocation"}},o._l(o.groupDepartureLocation,(function(e,n){return t("el-option-group",{key:n,attrs:{label:e.region}},o._l(e.children,(function(e,n){return t("el-option",{key:n,attrs:{label:o.displayLocation(e),value:o.displayLocation(e)}},[t("div",{staticClass:"my-product-tour-booking-content-option"},[o._v("\n                                        "+o._s(o.displayLocation(e))+"\n                                    ")])])})),1)})),1)],1):2===o.departureLocationStatus&&o.bookingInfoForm.departureLocation?t("el-form-item",{attrs:{label:"Meeting Point",prop:"departureLocation"}},[t("div",{staticClass:"my-product-tour-booking-content-readonly"},[o._v("\n                            "+o._s(o.bookingInfoForm.departureLocation)+"\n                        ")])]):o._e(),o._v(" "),3===o.departureLocationStatus?t("el-form-item",{attrs:{label:"Meeting Point",prop:"departureLocation"}},[t("el-input",{attrs:{placeholder:"Please enter"},model:{value:o.bookingInfoForm.departureLocation,callback:function(t){o.$set(o.bookingInfoForm,"departureLocation",t)},expression:"bookingInfoForm.departureLocation"}})],1):o._e(),o._v(" "),1===o.endLocationStatus&&o.endLocationOptions.length>0?t("el-form-item",{attrs:{label:"End Point",prop:"endLocation"}},[t("el-select",{attrs:{"popper-append-to-body":!1,placeholder:"Please select"},model:{value:o.bookingInfoForm.endLocation,callback:function(t){o.$set(o.bookingInfoForm,"endLocation",t)},expression:"bookingInfoForm.endLocation"}},o._l(o.groupDepartureEndLocation,(function(e,n){return t("el-option-group",{key:n,attrs:{label:e.region}},o._l(e.children,(function(e,n){return t("el-option",{key:n,attrs:{label:o.displayLocation(e),value:o.displayLocation(e)}},[t("div",{staticClass:"my-product-tour-booking-content-option"},[o._v("\n                                        "+o._s(o.displayLocation(e))+"\n                                    ")])])})),1)})),1)],1):2===o.endLocationStatus&&o.bookingInfoForm.endLocation?t("el-form-item",{attrs:{label:"End Point",prop:"endLocation"}},[t("div",{staticClass:"my-product-tour-booking-content-readonly"},[o._v(o._s(o.bookingInfoForm.endLocation)+"\n                        ")])]):3===o.endLocationStatus?t("el-form-item",{attrs:{label:"End Point",prop:"endLocation"}},[t("el-input",{attrs:{placeholder:"Please enter"},model:{value:o.bookingInfoForm.endLocation,callback:function(t){o.$set(o.bookingInfoForm,"endLocation",t)},expression:"bookingInfoForm.endLocation"}})],1):o._e()],1)]):o._e(),o._v(" "),o.productUpgradesInfo.length>0?t("div",{ref:"MyProductTourBookingUpgradesRef",staticClass:"my-product-tour-booking-content-item"},[t("div",{staticClass:"my-product-tour-booking-content-item-title"},[o._v("Add Extras")]),o._v(" "),t("div",{staticClass:"my-product-tour-booking-content-item-content"},o._l(o.productUpgradesInfo,(function(e,n){return t("el-form-item",{key:n,attrs:{prop:"upgradeInfo.".concat(n),label:"".concat(e.name).concat(e.subName?"(".concat(e.subName,")"):"")}},[t("el-select",{attrs:{multiple:1===e.canMultiSelect,"popper-append-to-body":!1,placeholder:"Please select"},model:{value:o.bookingInfoForm.upgradeInfo[n],callback:function(t){o.$set(o.bookingInfoForm.upgradeInfo,n,t)},expression:"bookingInfoForm.upgradeInfo[index]"}},o._l(e.options,(function(e,n){return t("el-option",{key:n,attrs:{label:e.name,value:e.id,disabled:o.disabledUpgradeOption(e)}},[t("div",{staticClass:"my-product-tour-booking-content-option"},[o._v("\n                                    "+o._s("".concat(e.name," ").concat(e.price))+"\n                                ")])])})),1)],1)})),1)]):o._e()],2)],1)]):o._e()}),[],!1,null,"14e94e91",null);t.default=component.exports},781:function(o,t,e){o.exports={}},782:function(o,t,e){o.exports={}}}]);